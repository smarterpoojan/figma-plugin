figma.showUI(__html__,{width:420,height:520});const n={hasSelection:!1,variables:[],styles:[]},u={variables:[],styles:[]},V=["fills","strokes","effects","opacity","fontSize","letterSpacing","lineHeight","fontName","textDecoration","textCase","cornerRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","itemSpacing","width","height"];function S(e){const s=[],i=[...e];for(;i.length>0;){const t=i.shift();t&&(s.push(t),"children"in t&&i.push(...t.children))}return s}function b(e){return[...e.values()].sort((s,i)=>i.usageCount-s.usageCount)}function p(e,s){const i=figma.variables.getVariableById(s);if(!i)return;const t=e.get(i.id);if(t){t.usageCount+=1;return}e.set(i.id,{id:i.id,name:i.name,resolvedType:i.resolvedType,usageCount:1})}function A(e,s){const i=e.boundVariables;i&&V.forEach(t=>{const l=i[t];l&&(Array.isArray(l)?l.forEach(a=>p(s,a)):typeof l=="string"&&p(s,l))})}function r(e,s){const i=figma.getStyleById(s);if(!i)return;const t=e.get(i.id);if(t){t.usageCount+=1;return}e.set(i.id,{id:i.id,name:i.name,styleType:i.type,usageCount:1})}function x(e,s){const i=e.fillStyleId;typeof i=="string"&&r(s,i);const t=e.strokeStyleId;typeof t=="string"&&r(s,t);const l=e.effectStyleId;if(typeof l=="string"&&r(s,l),"textStyleId"in e){const a=e.textStyleId;typeof a=="string"&&r(s,a)}}function g(){const e=figma.currentPage.selection;if(e.length===0){n.hasSelection=!1,n.variables=[],n.styles=[],figma.ui.postMessage({type:"selection-data",payload:n});return}const s=S(e),i=new Map,t=new Map;s.forEach(l=>{A(l,i),x(l,t)}),n.hasSelection=!0,n.variables=b(i),n.styles=b(t),figma.ui.postMessage({type:"selection-data",payload:n})}async function E(){const e=await figma.variables.getLocalVariablesAsync();u.variables=e.map(a=>({id:a.id,name:a.name,resolvedType:a.resolvedType,usageCount:0}));const s=figma.getLocalPaintStyles(),i=figma.getLocalTextStyles(),t=figma.getLocalEffectStyles(),l=figma.getLocalGridStyles();u.styles=[...s,...i,...t,...l].map(a=>({id:a.id,name:a.name,styleType:a.type,usageCount:0})).sort((a,o)=>a.name.localeCompare(o.name)),figma.ui.postMessage({type:"available-assets",payload:u})}function C(e,s){S(figma.currentPage.selection).forEach(t=>{const l=t.boundVariables;l&&Object.entries(l).forEach(([a,o])=>{var d,m;if(Array.isArray(o)){if(a==="fills"||a==="strokes"){const c=t[a];Array.isArray(c)&&o.forEach((f,v)=>{var h;if(f!==e)return;const y=c[v];y&&y.type==="SOLID"&&((h=t.setBoundVariableForPaint)==null||h.call(t,y,"color",s))});return}const I=o.map(c=>c===e?s:c);(d=t.setBoundVariable)==null||d.call(t,a,null),I.forEach(c=>{var f;(f=t.setBoundVariable)==null||f.call(t,a,c)});return}o===e&&((m=t.setBoundVariable)==null||m.call(t,a,s))})})}function T(e,s){S(figma.currentPage.selection).forEach(t=>{"fillStyleId"in t&&t.fillStyleId===e&&(t.fillStyleId=s),"strokeStyleId"in t&&t.strokeStyleId===e&&(t.strokeStyleId=s),"effectStyleId"in t&&t.effectStyleId===e&&(t.effectStyleId=s),"textStyleId"in t&&t.textStyleId===e&&(t.textStyleId=s)})}figma.on("selectionchange",()=>{g()});figma.ui.onmessage=e=>{if(e.type==="ui-ready"){E(),g();return}if(e.type==="replace"){const{kind:s,targetId:i,replacementId:t}=e.payload;s==="variable"?C(i,t):T(i,t),g()}};
